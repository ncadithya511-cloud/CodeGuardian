{
  "entities": {
    "CodeAnalysis": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "CodeAnalysis",
      "type": "object",
      "description": "Represents a single code analysis run.",
      "properties": {
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N CodeAnalysis) The user who initiated the analysis."
        },
        "timestamp": {
          "type": "string",
          "description": "Timestamp of when the analysis was performed.",
          "format": "date-time"
        },
        "technicalDebtScore": {
          "type": "number",
          "description": "The overall technical debt score for the analyzed code."
        },
        "code": {
          "type": "string",
          "description": "The code snippet that was analyzed."
        },
        "issues": {
          "type": "array",
          "description": "A list of issues found in the code.",
          "items": {
            "type": "object",
            "properties": {
              "title": { "type": "string" },
              "detail": { "type": "string" },
              "severity": { "type": "string", "enum": ["High", "Medium", "Low"] }
            },
            "required": ["title", "detail", "severity"]
          }
        },
        "explanation": {
          "type": "string",
          "description": "The AI-generated explanation for the analysis."
        }
      },
      "required": [
        "userId",
        "timestamp",
        "technicalDebtScore",
        "code",
        "issues",
        "explanation"
      ]
    },
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the CodeGuardian system.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the user."
        },
        "email": {
          "type": "string",
          "description": "The user's email address.",
          "format": "email"
        },
        "username": {
          "type": "string",
          "description": "The user's username."
        }
      },
      "required": [
        "id",
        "email",
        "username"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles.  Access is restricted to the user themselves.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/code_analyses/{analysisId}",
        "definition": {
          "entityName": "CodeAnalysis",
          "schema": {
            "$ref": "#/backend/entities/CodeAnalysis"
          },
          "description": "Stores code analysis runs for a specific user. Includes the userId in the path to ensure the user owns the analysis.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "analysisId",
              "description": "The unique identifier for the code analysis run."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the CodeGuardian application, prioritizing authorization independence, clarity, and scalability. It leverages path-based ownership for user-specific data and separates data with different access requirements into distinct collections to simplify security rules. This design also enables secure list operations and maintains data integrity through consistent ownership and naming conventions.\n\n1.  **User Data:** User profiles are stored in `/users/{userId}`. This path provides clear ownership and is used for private user data.\n2.  **Code Analyses:** Code analysis results are stored in `/users/{userId}/code_analyses/{analysisId}`. This structure enforces ownership (only the user can access their analysis) and allows easy retrieval of all analyses for a specific user."
  }
}
